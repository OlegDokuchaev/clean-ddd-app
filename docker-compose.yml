version: "3.8"
name: "clean-ddd-app"

services:
  order_db:
    container_name: "clean_app_order_db"
    image: postgres:latest
    volumes:
      - postgres_data_order:/var/lib/postgresql/data/
    ports:
      - "5444:5432"
    env_file:
      - ./order/.env
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready" ]
      interval: 10s
      timeout: 5s
      retries: 5

  warehouse_db:
    container_name: "clean_app_warehouse_db"
    image: postgres:latest
    volumes:
      - postgres_data_warehouse:/var/lib/postgresql/data/
    ports:
      - "5445:5432"
    env_file:
      - ./warehouse/.env
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready" ]
      interval: 10s
      timeout: 5s
      retries: 5

  courier_db:
    container_name: "clean_app_courier_db"
    image: postgres:latest
    volumes:
      - postgres_data_courier:/var/lib/postgresql/data/
    ports:
      - "5446:5432"
    env_file:
      - ./courier/.env
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready" ]
      interval: 10s
      timeout: 5s
      retries: 5

  customer_db:
    container_name: "clean_app_customer_db"
    image: postgres:latest
    volumes:
      - postgres_data_customer:/var/lib/postgresql/data/
    ports:
      - "5447:5432"
    env_file:
      - ./customer/.env
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready" ]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  postgres_data_order:
  postgres_data_warehouse:
  postgres_data_courier:
  postgres_data_customer:
